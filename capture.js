// console.show();

// 请求横屏截图
if (!requestScreenCapture()) {
    toast("请求截图失败");
    exit();
}

let mainMenu = images.fromBase64("data:image/png;base64,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");

let window = floaty.window(
    <vertical>
        <button id="stop" text="stop script" style="Widget.AppCompat.Button.Colored" alpha="0.5" />
    </vertical>
);

window.stop.click(() => {
    log("结束！");
    exit();
});

let image = null;

// 多线程
let screen = events.emitter(threads.currentThread());
threads.start(function () {
    //在新线程执行的代码
    setInterval(() => {
        let img = captureScreen();
        screen.emit('result', img);
    }, 200);
});
screen.on('result', function (img) {
    image = images.copy(img);
});

setInterval(() => {
    if (image) {
        log(images.findImage(image, mainMenu));
    }
}, 1000);

// function main(){
//     log(Date.now());
//     image = captureScreen();
//     log(Date.now(), image);
// }

// main();